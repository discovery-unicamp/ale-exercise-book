## Applying a Filter to an Image

### Instructions

In this activity, you must write a program in RISC-V assembly language that reads an image in PGM format from a file, applies an edge detection filter and shows the result on screen using the canvas peripheral.

The first step of this exercise is to read an image in the PGM format and store its content in a matrix (exactly as done in exercise 7.4). After that, you must apply the following filter on the image:

$$
w = \begin{bmatrix}
    -1 & -1 & -1 \\
    -1 & 8 & -1 \\
    -1 & -1 & -1
\end{bmatrix}
$$

Assuming w the filter matrix above, Minthe matrix representing the input image and Mout the matrix representing the output image. The basic idea of applying the filter is that each Mout pixel[i, j] is defined as:

$$
    M_{out}[i][j] = \sum_{k=0}^{2} \sum_{q=0}^{2} w[k][q] * W_{in}[i+k-1][j + q - 1]
$$

Note that this can lead to the Min matrix to be indexed with invalid indices (negative or out of bounds). In order to avoid these cases, the border pixels of the image Mout must be initialized with black and it is not necessary to compute the filter value for them. You can visualize how this filter works in [Image Kernels explained visually](https://setosa.io/ev/image-kernels/) (select the "outline" filter). This filter is also known as the Laplacian operator for edge detection.

Also note that the image _pixels_ must have values between 0 (black) and 255 (white). If the result of the equation presented above is not in this interval, you must use the closest value in the interval (i.e., values lower than 0 become 0, and values greater than 255 become 255).

### Input

Your program must read a file called "image.pgm" that will be in the same directory as the executable file, as explained in [Exercise 6.4](ch06-04-image-on-canvas.md).

### Output

Your program must show the result image on the screen, using the Canvas peripheral, as explained in [Exercise 6.4](ch06-04-image-on-canvas.md).

### Notes and Tips

- **You need to resize the canvas (setCanvasSize syscall) according to the file header.**
- You can test your code using the simulator's assistant from this <a href="https://riscv-programming.org/ale/#select_url_content=TjRJZ3RnaGdsZ2RnK2dCd2djd0tZZ0Z3aEFHaEJBWndLZ0lCY0laUzRDQmpBSnlnVk14Q2pBUUhzN1NBQ1lBVlFDU2NBQktvQU5nbFIwY1BBSUpFUzVTbkFESzlScVFDK1BBR1owT1lIZ0IwUUFPZ0QwWURnQk1BcnVOUUVMaFltUXFrekFLd0tuak1OazV1UGdBWkRob0ljUUFsVkNEdFBRTWpVMHRyZTBkbkdnNFlHRlFhVWlnczcxOFFBRzUtUUs1ZVlCNWlNQWNJVWk0NFRNb0RjVWM2SGgxOVF4TnpLMXNISnd0YStzYTZJdE15Z1BaS25naVlBRGRDQk43a2kxUUFEMUpVR0dJczV4dFVSYWdhWVlYbGdrbVFmMzhhY1ZjZUFGRk5nRFk0QUZZZUxaMllHd0o1SXAzQ3AxQXdtTUItRHg1Z2RTSFE3SGt1QUFLQUNVRUpnVUtoQkRzVWpvS09tR0o0cEFBRmlRekhZb0R3QUx3OEhJQWR4NFFsRUVoeGlOTUwya05CSXFCNHJ6TUh3dzhnUUNIRUFFOVlNZ2VCQWVBQXhLRGlIYWRScVM5R0NTQm9Vekk2YVFqR09YaHNaQndIWmtLbVNnZ2ltQTBIaHdLa0FQajQyb0p1cDQrcE54TkphQnlkQWFxRGc0bGdUanhEb3hvd2U0MmFXVmhISGEwak00ZzRFQnNjRHBjRjBjdFFpUDFBRzBBQXdBWFUxUWFoVUYwaUlBaElpSUxUb0x3M1ZjNGZBUXcwa2NpVzJpQ1FUYTJTb0xHT01oV1NBQUhJY1BScG1vU1hJN0d3YS1IdHFHZHVOOTB4RGtlT01lT1BLb0tjZ0F2bzJjOE9pb1VoMk9qbzNTUkFpb0djRXJTRnlWVnFDOFN2Vndra3E3M3FpNkpvY095a0JBLXhIQUdBQkRJQmdwajhCZW5Sa0J3Q0NtTEl1aEVnS0FCTXNqNUdBcURmcVFHQUFNelpyaDJaYUR1czR0TWFCNVl2S0pvWElRWmhzQ2dxQUFDSU5CQVpnMkl4VjRZcDJVRUlOUWJCak0yYkZ6cStQWUdoaGY2a0lHdTRFc1dpS1VWY05Gb0F4NURNWXhzYTdNZ3hJOEtXMUpaZ0FqTG1BQlVBQXNxSzNnSnBMa2tKaUlBQWFDQmFYQUhua1BDcUZBQUJlcUFDZ0FKTUFPbjZRWk9pYVR3bmt5ZFJhcjBjcExHS1k0TUJxVVNXaVdZUmU3enIyVmsyWmtkRDJid1RtdVI1WGxnTWdtYTZZWmZuVW9GRkNYTUZ0RUtVeDRWTVpGMFd4ZkZzNEhrZUo1Nk9lbDYzamVFa1lwK25TSWs2RkxVdG1KVE9qd0FBOHpxNWZsdWJEVkFBRFVzM0l2YVhXU1NXcEVPS1FtWlFJWnVZYVZwazJJYm1tMzVtMmU2bVZjNWtMc2x0bHBST1BBQUFwUUpzRWpaVkFPaUlwNWEzeXB0MjFGUUZPVjVRZFIwRVhGLUh0b2xmYldkZDZYM1k5ejEtYTlQRHZjQW4wYlZ0Qm01cjlubFpvRFVBWThpSU1tUmlUWEhxZWJXZzFDbld6cFQ3YkV5MXNKMktnUWJVMUNrSkJrNkI1eENhZEk4R0VFVFJMRWxUaVIyZ2t0RGtlUUZIc1poLWdRUktJaHpsUU5TK3BJSUFlUnlwamtpWVFIUXlBQXRTbWFtQUF0QWJkSitnQVJyQmZSR3hlc0tvTWdGdW1BUUNDVXRtbXdBT3pTaDdIc0FNTDJ5QVJza0JBdnNRRFFOaXBrQmRpbU5OUWFkdVpDYUprYVltM3FZWHVHQWdjb05CTHNHM3RhbEoyaWRqVUM5d1ppa2VRM0JDM3V0UG9wMkhyU0tjNGJzR21ocE9HSnlMbDllUEN5TGUxUm5uS2NDb0Zyb29DdlQzTE16d2lzeDkyY2ROMlEtWUFDck56dzJrVy1xMCtrT1BnbXh6WThmTjNQQytJY3Z1V3IrdlptVDF2cSs3OGFXRUh3YUNmSCtkcC1ielBwano4YUJuWDBmYkVUMllVOEp4ZnZBZk8tVytXb3VwZjNWcEVPQUtNVFE1eHRQbkltaGRQRHkyNFByRUFDY0lGT0hXc1VIYTFJdjZvSlJnUVVHVHBrQmVpT0NhSWF0NWl5SXh3YzNOQlpGU0FFQnpEdGZ5MlpGcXdNZEllR2txOWRaSzN2bVlYQjZENVJYRnFzU1FtUFZFYjlSTk5wR2FZME9FSjN3YzZlYUxEQ1pRaUlRbWJrczFzRWIyN0h3Mmg5RGNia3k2SVRGUkpEcVNJaU1keVBTaTltRThBc0lqZUFzaURiYVVWaFRXOGlDRUh3T1FXQThRY0F6R1J4TkdZZ2g3RFRaeGxOaWFWeFpnYTVlaDJHZ3VJYmM0SE5YUkpaQUE0c1F0eWYwekZhRE1Ed09pSEJhUXdEakFtSGdJcHZ5S2dYcTQxWVJnRkJ1R1VMd0xZdVFmd1N6R2xLSWtCNWRDVWs4clNXQU5nY2xtSDRGRUVJWmg2RDl4MkFBZVZObDRDY3ZTUWlJaUNSd1UyeUlkQmROeWZrbXdsSlRCYkhlQjhZdThEVEEybWtuNkdnQUJySGdSSnBDb0dSS05Gd05vekNXU1p0cVRxMm9JbmVsOVA2QWdLSllFV0JzU2MxUmRBMmJzTTJCSTdNdnplQWlnQlVDNDUtY2poMEdvTENFMGxrN29BUDhKNVRZT2hQSWlodlA0UkNId0VVd0J1VjFKMFh6SVZjMVFQU2VlMnduaTJVaGYySDh1Z0RZQUE0TlJtRjJKa0k0aUlDWFNHaFhRUldUcHFwRXZwUHdXQXBCYVZ5RFNoQUVVaUpOaDZSRklyWWl2QlRZR2t5SEdUb0dqU1JlaitBS3hFMlljQ1lvK0lyVVJmVjJFRFI0RU5FYTQxcW9xU2lzU0dhQ2lscXptcWtkRTBjcnd5S3JZcVBKMDhBLVE1QzRaMlZWTmgxWGFVMVR3UkN1RmRWY0RFUWEwaFVqeHJ1cGVWYWhhTnIyd3lwNEpzT0FzQkRYZW9vTDZ5Z0dyWkNiRTFBU1c4aWFSUXBvQ0s2UVNQcjFVQnFsY05BdE1JazF3RjlVcTdoeGNNM3FvY1RnUnh3MFdiTFdoSHNZRjlhb0NOdlRXcXJOYmFPMFlocmIybW9MbHVUS3JyQzJyTmxhODFkcUlyV2hWb2JaM051SFdKQU4ycTgyM2oxVTZMd0VhZUJIdkdzUVZ5dzB2RFd0WVJpUk5VQWJELUpNY20xTlBCWm9ucjBzbWh0aTBMSC1MZllpSXRMNjMxZUVsZjJ6bCtpcEwzditlTmJNUEFBQStzSG5RUHA0RGFha1pxaEZFa1dxYkE4RUFEbjZMdFpCckIwSm5VZFZ1WGl3SndUZVU4QUFFTEJNUkptTmxNZ2VEVlZ6TElZQXBBUlJTQUZLWUNBUXA5a1p5eUJZY0lPeFNBR3pJTmhzQXBnQ0pzU2RLbVZjMUp1YXlrY0hSbVpwc1dOOURrcWdLV3lBSlBiallwWEhnbVpaT29CelpLbENna2VQQ2lMUWM2UU9SeENJbXFqbTJRSXBaQ1pqYlR3TnpIbnRLeUI0TFMyUW5tLU5lZmM3cFpFVWRkejNOM09Xck5ZQllDeUVnTG0rTlVKb3ZvbXBBQVdRYUVTQVpxQTVTSWlTNHJPTEpvMHZFak1Mb09NU0k0dUszMDRWakxKV09CSWlxNXVycFlBVVE4QXNUbGlBLXlEWThDUzYreGVMWWV0SlpuT0ZxRUZuUlJ3R3N5ZUNROW5BdTBsa0VTV1FCekZGZFdXSjBHd2lGS1A4c29FS2tWWXJhUjZRdzJ4RDVQQlRaY0VoVUdBOTRiQnFSdU9iR3hidHJFTGZWcElSc2gzYlZzUFo2LVNUcnVrSTJrWUpPZHZVeDZLVGpWcERkaExHSlh1NDIreTkrN0ZJLTFFbmM3MXZTajNJZlhpRElkM1FkZ0xUNUN5T1VuZ3FwYUk4QUFOSTJZa0FDTFl3cG9BYXg0Q2NMRWtSUlNJeUpLUVg4QkFNQWZPdGh3QWdURUNnYkVXQllEVEJ0eHUyZWNNaUlNeTNFT2JGa0ZBV1FYZ3p0SWtOWklrMXh6NGZ5N21uR205UFZFUkh1cFBMMDlQQVB1TDB2ZGV3bWtHVFFVZ3NmU0lEaE5Ec0FIVTVCUkFISUlBY2lTQlRES1lHd2FkTmhvUkhETUlUSjB5eHhBbWxaTjIyMTJsTXdaaVY5KzNYUFdOZmg1MmhZZzVEQ2xFOVpzQ0hzUG4ySS1tOFJrZWpFSVdXczhIajdwUlBiN2sraDRwR24zUEdmbzl2c2NiSHZQbVlEcUY2WXluaWsyZnk5UjZQV25tdjhlc0s1Z2I4WHNQTGV6ZHQ0SkRudVBtWjBhOTZiOFAxdmY2ajFWNUg3WGo0UGVnOFlpTDVQdWYwLU04eDl6LUgxNFMtVHBRbFh5WG5yamlOLVIrejUzek1yczktNzhQMkg5ZmcrWi1ILW4tSDJsMS1aeUxRUTg5MDY0T0gyRWI5OGh3TkxGSGdBQWZrQUsrQUZILTJnMUFKZ3dnTWlGQmxIbEhuMDFXMEcxdUJnSEMyNWhlQTJYTG0xRndCQUJhRlRHUUV3RkFHZ2l4ejJDSUx3S3lBSUpUUTV6a0V3R0hqd0h3S2dBTkFEaTlqb0xoR013b0pnQ29JRGpvallJWmdZTW9LWU9vSWdHbEQ0STRNWU9ZSTUwRURFSUVLNEtFSURoU3hrTTRPNEk1MVVDVUlrT0VQNENVTjJBZ0NDUjlBSUE0R2FCT1VPV08wMkNVSU1PaFdEZ09VUUE0QUZYWlQ5d1poWUJkbmRrOW1sRllMd0FGUlRBUEFBRWNJRUtBMEFXQk1VUUF0QThBelJhQmFjQ0FpQ1FpUUFqZ1RnemhJaU1CUUFnb2ZCeUNDQTR4bUFNQk1WWGd0QWNpdEFnQQ==" target="_blank">link</a>.
